<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#111;
  color:#fff;
  font-family:sans-serif;
  text-align:center;
  margin:0;
  padding:20px;
}
button {
  font-size:18px;
  padding:14px 26px;
  margin:6px;
}
#tapBtn {
  font-size:28px;
  padding:32px 64px;
  margin-top:20px;
}
.hidden {
  display:none !important;
  pointer-events:none !important;
}
.boss { font-size:80px; }
.player { font-size:60px; margin:10px; }

.hp-bar {
  width:80%;
  height:20px;
  background:#444;
  margin:10px auto;
  border-radius:10px;
  overflow:hidden;
}
.hp {
  height:100%;
  background:red;
  transition:width 0.1s;
}

.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:999;
  font-size:26px;
  text-align:center;
  padding:20px;
}

/* ãƒ¬ã‚¢ãƒªãƒ†ã‚£è‰² */
.rare { color:#4af; }
.sr { color:#c6f; }
.hr { color:#fa4; }
.ur { color:gold; }
.lr {
  background:linear-gradient(45deg,red,orange,yellow,green,cyan,blue,purple);
  -webkit-background-clip:text;
  color:transparent;
  font-weight:bold;
}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>ğŸ’° ã‚³ã‚¤ãƒ³: <span id="coin">0</span></p>
<p>âš” æ”»æ’ƒåŠ›åˆè¨ˆ: +<span id="atk">0</span></p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£ï¼ˆ100ã‚³ã‚¤ãƒ³ï¼‰</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<div id="select">
  <h2>ãƒœã‚¹é¸æŠ</h2>
  <button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
  <button onclick="startBattle('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹',20)">ã‚ªãƒ¼ã‚¯</button>
  <button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',500,'ğŸ‰',50)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
</div>

<div id="game" class="hidden">
  <h2 id="bossName"></h2>
  <div class="boss" id="bossIcon"></div>
  <div class="hp-bar"><div class="hp" id="hp"></div></div>
  <p>HP: <span id="hpText"></span></p>
  <button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let coin = Number(localStorage.getItem("coin") || 0);
let atkBonus = Number(localStorage.getItem("atkBonus") || 0);
let dex = JSON.parse(localStorage.getItem("dex") || "{}");

let bossHp = 0;
let maxHp = 0;
let reward = 0;
let startTime = 0;
let tapCount = 0;

/* ===== DOM ===== */
const coinText = document.getElementById("coin");
const atkText = document.getElementById("atk");
const overlay = document.getElementById("overlay");
const player = document.getElementById("player");

coinText.textContent = coin;
atkText.textContent = atkBonus.toFixed(1);

/* ===== è¦‹ãŸç›® ===== */
function updatePlayer(){
  if (atkBonus >= 5) player.textContent="ğŸ˜‡ğŸŒˆ";
  else if (atkBonus >= 3) player.textContent="ğŸ˜âœ¨";
  else if (atkBonus >= 1.5) player.textContent="ğŸ˜¤ğŸ”¥";
  else if (atkBonus >= 0.5) player.textContent="ğŸ™‚ğŸ’«";
  else player.textContent="ğŸ™‚";
}
updatePlayer();

/* ===== overlayï¼ˆå®Œå…¨å®‰å…¨ï¼‰ ===== */
function showOverlay(html){
  overlay.innerHTML = html + "<br><br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
  overlay.classList.remove("hidden");
}
function hideOverlay(){
  overlay.classList.add("hidden");
  overlay.innerHTML = "";
}
overlay.addEventListener("click", hideOverlay);

/* ===== ã‚¬ãƒãƒ£ ===== */
function drawGacha(){
  hideOverlay();
  if (coin < 100) {
    showOverlay("ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šãªã„ï¼");
    return;
  }
  coin -= 100;
  coinText.textContent = coin;
  localStorage.setItem("coin", coin);

  showOverlay("ğŸ° ã‚¬ãƒãƒ£ä¸­â€¦");

  setTimeout(() => {
    const r = Math.random() * 100;
    let g = {name:"ãƒ¬ã‚¢", atk:0.1, cls:"rare"};

    if (r < 2) g={name:"ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ãƒ¬ã‚¢", atk:1.5, cls:"lr"};
    else if (r < 7) g={name:"ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢", atk:1, cls:"ur"};
    else if (r < 22) g={name:"ãƒã‚¤ãƒ‘ãƒ¼ãƒ¬ã‚¢", atk:0.5, cls:"hr"};
    else if (r < 50) g={name:"ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¢", atk:0.3, cls:"sr"};

    atkBonus += g.atk;
    atkText.textContent = atkBonus.toFixed(1);
    localStorage.setItem("atkBonus", atkBonus);
    updatePlayer();

    dex[g.name] = (dex[g.name] || 0) + 1;
    localStorage.setItem("dex", JSON.stringify(dex));

    showOverlay(
      `<div class="${g.cls}">
        âœ¨ ${g.name} âœ¨<br>
        æ”»æ’ƒåŠ› +${g.atk}<br>
        åˆè¨ˆ +${atkBonus.toFixed(1)}
      </div>`
    );

    setTimeout(hideOverlay, 1400);
  }, 800);
}

/* ===== å›³é‘‘ ===== */
function showDex(){
  let html = "<h2>ğŸ“– å›³é‘‘</h2>";
  for (let k in dex) html += `<div>${k} Ã— ${dex[k]}</div>`;
  showOverlay(html);
}

/* ===== ãƒãƒˆãƒ« ===== */
function startBattle(name,hp,icon,coinReward){
  hideOverlay();
  tapCount = 0;
  bossHp = maxHp = hp;
  reward = coinReward;
  startTime = Date.now();

  document.getElementById("bossName").textContent = name;
  document.getElementById("bossIcon").textContent = icon;
  updateHp();

  document.getElementById("select").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
}

function updateHp(){
  document.getElementById("hpText").textContent = Math.ceil(bossHp);
  document.getElementById("hp").style.width = (bossHp / maxHp * 100) + "%";
}

document.getElementById("tapBtn").onclick = () => {
  tapCount++;
  let dmg = 1 + atkBonus;
  if (tapCount % 10 === 0) dmg += 1;

  bossHp -= dmg;
  if (bossHp < 0) bossHp = 0;
  updateHp();

  if (bossHp === 0) {
    const time = ((Date.now() - startTime) / 1000).toFixed(2);
    coin += reward;
    coinText.textContent = coin;
    localStorage.setItem("coin", coin);

    document.getElementById("game").classList.add("hidden");
    document.getElementById("select").classList.remove("hidden");

    showOverlay(`ğŸ‰ æ’ƒç ´ï¼<br>â± ${time} ç§’<br>ğŸ’° +${reward} ã‚³ã‚¤ãƒ³`);
  }
};
</script>

</body>
</html>
